<html>
	<head>
		<title>OGAM#1 Zilok</title>
		<style>
			body {
				margin: 0;
				padding: 0;
				background-color: #000000;
			}
		</style>
	</head>
	<body>
		<script src="lib/pixi.dev.js"></script>
		<script src="src/core.js"></script>
		<script src="src/components/components.js"></script>
		<script src="src/prefabs/prefabs.js"></script>
		<script src="src/systems/Render.js"></script>
		<script src="src/systems/systems.js"></script>
		<script>
			var w = 500,
				h = 300,
				stage = new PIXI.Stage(0x18060C),
				renderer = PIXI.autoDetectRenderer(w, h);

			PIXI.scaleModes.DEFAULT = PIXI.scaleModes.NEAREST;

			document.body.appendChild(renderer.view);

			var texture = PIXI.Texture.fromImage("res/images/tank.png"),
				assetsToLoader = ["res/images/tank.json"],
				loader = new PIXI.AssetLoader(assetsToLoader);

			var bits = [];
			var ents = [];

			loader.onComplete = startMeUp;
			loader.load();

			var blurFilter1 = new PIXI.BlurFilter();


			function startMeUp () {

				for (var i = 0; i < 100; i++) {

					var tank = new PIXI.Sprite(texture);
					//tank.filters = [blurFilter1]
					tank.anchor.x = 0.5;
					tank.anchor.y = 0.5;

					tank.position.x = (Math.random() * (w - 100)) + 100;
					tank.position.y = Math.random() * h;

					tank.scale.x = 2;
					tank.scale.y = 2;

					tank.tint = Math.random() * 0xFFFFFF;

					tank.blendMode = PIXI.blendModes.ADD;

					var tt = createEntity("tank", {
						pos: {
							x: tank.position.x,
							y: tank.position.y
						},
						sprite: {
							ref: tank
						},
						sinbounce: {
							freq: Math.random() * 200 + 200
						}
					});

					ents.push(tt);

					stage.addChild(tank);

				}

				for (var i = 0; i < 4; i++) {

					for (var j = 0; j < 4; j++) {

						var bit = PIXI.Sprite.fromFrame("f" + j + "_" + i);

						bit.scale.x = 4;
						bit.scale.y = 4;
						bit.position.x = (j * 16) + 20;
						bit.position.y = (i * 16) + 60;
						bit.anchor.x = 0.5;
						bit.anchor.y = 0.5;

						stage.addChild(bit);

						bits.push(bit);

					}
				}


				for (var i = 0; i < ents.length; i++) {
					var e = ents[i];

					//sys.Sprite.init(e);
				}

				run();

			}

			function run() {

				bits.forEach(function (t, i) {

					t.position.y += Math.sin(Date.now() / 300 + i) * 0.9;

				});

				blurFilter1.blur = (Math.max(0, Math.sin(Date.now() / 400) - 0.5)) * 20 ;

				for (var i = 0; i < ents.length; i++) {
					var e = ents[i];

					sys.AI.update(e);
					sys.Physics.update(e, 1);
					sys.Render.update(e);

				}

				renderer.render(stage);
				requestAnimFrame(run);
			}

		</script>
	</body>
</html>